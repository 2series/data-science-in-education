---
title: "Exploring Nationally- and Internationally-Representative Data"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, cache = F)

library(tidyverse)
library(here)
```

## Introduction

A common situation encountered when using data for analyzing the education sector, particularly by analysts who are not directly working with schools or districts, is the prevalence of publicly available, aggregate data. [Aggregate data refers to numerical or non-numerical information that is (1) collected from multiple sources and/or on multiple measures, variables, or individuals and (2) compiled into data summaries or summary reports, typically for the purposes of public reporting or statistical analysis.](https://www.edglossary.org/aggregate-data/) Example of publicly available aggregate data include school-level graduation rates or state test proficiency scores by grade and subject.

These datasets are large, lagging, and often suppressed to protect privacy. Because of their coarseness, they can be difficult to use to prove causal linkages. However, these datasets can help analysts understand the landscape of needs and opportunities in the field of education through descriptive analysis.

Descriptive analysis describes, shows, or summarizes data in a meaningful way. As opposed to causal analysis, which aims to assess the root cause of an phenomenon or the effects of an intervention, descriptive analysis is needed to find out whether there _is_ a phenomenon, _what_ it is, and _what_ we'd be trying to solve through interventions.

Descriptive analysis of aggregate data can help us identify patterns that may not have previously been known. When we have gained new insight, we can create research questions, craft hypotheses around our findings, and make recommendations on how to improve for the future.

## Data

There are many publicly available aggregate datasets. On the federal level, examples include:

- [Civil Rights Data Collection (CRDC)](https://www2.ed.gov/about/offices/list/ocr/data.html), which reports many different variables on educational program and services disaggregated by race/ethnicity, sex, limited English proficiency, and disability. These data are school-level.

- [Common Core of Data (CCD)](https://nces.ed.gov/ccd/), which is the US Department of Education's primary database on public elementary and secondary education.

- [EdFacts](https://www2.ed.gov/about/inits/ed/edfacts/data-files/index.html), which includes state assessments and adjusted cohort graduation rates. These data are school- and district-level.

- [Integrated Postsecondary Education Data System (IPEDS)](https://nces.ed.gov/ipeds/), which is the US Department of Education's primary database on postsecondary education.

- [National Assessment for Educational Progress (NAEP) Data](https://nces.ed.gov/nationsreportcard/researchcenter/datatools.aspx), an assessment of educational progress in the United States. Often called the "nation's report card."

There is an immense amount of data available in the education field. Descriptive analysis requires us to be deliberate by honing in on a research or policy question. By honing in on what we're hoping to accomplish, we can distill these datasets into something meaningful.

For the purposes of this walkthrough, we will be looking at NAEP 2017 results. The NAEP reading and mathematics assessments are administered to a representative sample of fourth- and eighth-grade students in each state every two years. The data allows us to look across states and time. The NAEP results can also be disaggregated by different variables, including race/ethnicity.

### Import

These files are available on the [Nation's Report Card](https://www.nationsreportcard.gov/); however, they are not tidy and come with a lot of formatting and merged cells. Therefore, wrangling the dataset is necessary before any analysis can occur.

```{r, echo = F}
naep17 <-
    readxl::read_xlsx(
        here::here("data", "naep", "NDECoreExcel_Mathematics, Grade 8, Race ethnicity used to repor_20190825230831.xlsx"), 
        skip = 8)

str(naep17) # notice the proficiency rates are imported as characters
```

### Cleaning

The dataset contains a column with year, states/jurisdiction, race/ethnicity, and the proficiency rates for each one, and miscellaneous columns denoting statistic significance. There are also rows at the bottom with additional information on the dataset. For the purpose of our walkthrough, we want the dataset to be as clean and simple as possible. We will remove the rows with additional information and transform the proficiency rates to numeric.

The dataset denotes statistical significance with an asterisk. If we change the proficiency column to numeric without cleaning this up, all those datapoints will be transformed to NA. We will need to get rid of them before transforming the column to numeric.

Note that there are states that suppress values for ethnicity/races whose populations are too small to report. These will show up as NA in our tidy dataset.

```{r, warning = FALSE}
naep17_tidy <-
    naep17 %>%
    janitor::clean_names() %>% 
    dplyr::slice(-319:-342) %>% # remove rows containing additional information
    mutate(at_or_above_proficient_clean =  stringr::str_replace(at_or_above_proficient, '\\*', '')) %>% # create a new column without *
    mutate_at(vars(at_or_above_proficient_clean),
              funs(as.numeric(.)/100)) %>% # transforming proficiency rates to numeric decimals
    select(-at_or_above_proficient) %>% # removing original proficiency columns
    rename(race = race_ethnicity_used_to_report_trends_school_reported) # shortening name
```

We want to make sure our data is as complete and accurate as possible. We can use `groupby()` to see where our missing values are by jurisdiction or subgroup - or both! Running the code below, we see that Maine is the state with the most NA's, totalling five in this dataset.

```{r}
naep17_tidy %>% # see missing values by jurisdiction
    group_by(jurisdiction) %>% 
    summarise(sumNA = sum(is.na(at_or_above_proficient_clean))) %>%
    arrange(desc(sumNA))
```
We also want to see what the distribution of proficiency scores can look like across states.

```{r}
naep17_tidy %>% 
    group_by(race) %>% 
    summarize(min = min(at_or_above_proficient_clean, na.rm = T),
              q1 = quantile(at_or_above_proficient_clean, 0.25, na.rm = T),
              mean = mean(at_or_above_proficient_clean, na.rm = T),
              q3 = quantile(at_or_above_proficient_clean, 0.75, na.rm = T),
              max = max(at_or_above_proficient_clean, na.rm = T))
```

## Analysis

Now that we have our clean dataset and have taken a peek into the data, we can proceed to take a look at different aspects of the data. 

### Discovering Distributions

### Making Comparisons

### Finding Inequities

### Working with Suppression

### Statistical Inferences

## Results

## Conclusion

## Appendix

Loeb, S., Dynarski, S., McFarland, D., Morris, P., Reardon, S., & Reber, S. (2017). [Descriptive analysis in education: A guide for researchers.](https://ies.ed.gov/ncee/pubs/20174023/pdf/20174023.pdf) (NCEE 2017â€“4023). Washington, DC: U.S. Department
of Education, Institute of Education Sciences, National Center for Education Evaluation and Regional Assistance. 